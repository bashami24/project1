EXECUTE IMMEDIATE '
  var startDate = new Date("2022-10-01");
  var endDate = new Date("2024-04-30");
  var currentDate = new Date(startDate);
  while (currentDate <= endDate) {
    var monthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
    var monthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
    var formattedMonthStartDate = monthStartDate.toISOString().slice(0, 10);
    var formattedMonthEndDate = monthEndDate.toISOString().slice(0, 10);
    
    var table1Query = "SELECT columns FROM my_db.my_schema.table1 WHERE date BETWEEN '''" + formattedMonthStartDate + "''' AND '''" + formattedMonthEndDate + "''' GROUP BY 1,2,3;";
    var table2Query = "SELECT columns FROM my_db.my_schema.table2 WHERE date BETWEEN '''" + formattedMonthStartDate + "''' AND '''" + formattedMonthEndDate + "''' GROUP BY 1,2,3;";
    var finalQuery = "WITH table1 AS (" + table1Query + "), table2 AS (" + table2Query + ") SELECT a.*, b.* FROM table1 a LEFT JOIN table2 b WHERE conditions;";
    
    try {
      var resultSet = snowflake.execute({ sqlText: finalQuery });
      // Process the resultSet for the current month
      // For example, log the results or perform further operations
    } catch (err) {
      // Handle any errors that occur during execution
      // For example, you can log the error
    }
    
    currentDate.setMonth(currentDate.getMonth() + 1); // Move to the next month
  }
';
