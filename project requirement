corrected_reopen_snapshot AS (
    SELECT
        fs.*,
        fr.NEW_REOPENED_REPORTED_COUNT_1 AS Corrected_REOPEN_VALUE,
        ROW_NUMBER() OVER (PARTITION BY fs.CLAIM_NUMBER, fs.EXPOSURE_PUBLICID_NK, fs.CLAIM_SYMBOL_CODE ORDER BY fr.NEW_REOPENED_REPORTED_COUNT_1 DESC) AS rn
    FROM feature_snapshot fs
    JOIN final_reopen fr ON fs.CLAIM_NUMBER = fr.CLAIM_NUMBER
                          AND fs.EXPOSURE_PUBLICID_NK = fr.EXPOSURE_PUBLICID_NK
                          AND fs.CLAIM_SYMBOL_CODE = fr.CLAIM_SYMBOL_CODE
    WHERE fs.NEW_REOPENED_REPORTED_COUNT_1 = 0
)
SELECT *
FROM corrected_reopen_snapshot
WHERE rn = 1;
