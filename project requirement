CASE
    WHEN REOPEN_TIMESTAMP BETWEEN {{snapshot_begin_date}} AND {{snapshot_end_date}}
         AND (
               STATUS_NAME = 'Closed' AND
               LAG(STATUS_NAME) OVER (PARTITION BY CLAIM_NUMBER, EXPOSURE_PUBLICID_NK, CLAIM_SYMBOL_CODE ORDER BY REOPEN_TIMESTAMP) = 'Reopened'
             )
         OR
         (
               STATUS_NAME = 'Reopen' AND
               COUNT(STATUS_NAME) OVER (PARTITION BY CLAIM_NUMBER, EXPOSURE_PUBLICID_NK, CLAIM_SYMBOL_CODE ORDER BY REOPEN_TIMESTAMP) >= 3 AND
               LAST_VALUE(STATUS_NAME) OVER (PARTITION BY CLAIM_NUMBER, EXPOSURE_PUBLICID_NK, CLAIM_SYMBOL_CODE ORDER BY REOPEN_TIMESTAMP) = 'Reopen'
             )
    THEN 1
    ELSE 0
END AS NEW_REOPENED_REPORTED_COUNT_1
