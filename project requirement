SELECT * FROM
(
SELECT * FROM
feature_snapshot_stg1
QUALIFY ROW_NUMBER() OVER( PARTITION BY CLAIM_NUMBER,EXPOSURE_PUBLICID_NK, CLAIM_SYMBOL_CODE
                          ORDER BY  CASE WHEN ACCOUNTING_TIMESTAMP <= '2022-10-31 23:59:59'THEN ACCOUNTING_TIMESTAMP
       ELSE RECORD_BEGIN_TIMESTAMP  END DESC   ) = 1
) WHERE STATUS_NAME in ('Open', 'Reopened')
